{% extends "base.html" %}

{% block content %}
{% with messages = get_flashed_messages() %}
    {% for msg in messages%}
        <div class="alert alert-success">
            {{ msg }}
        </div>
    {%endfor%}
{% endwith %}
<h3>თბილისის აუდიო ასოციაცია</h3>
<br>
<form class="d-flex ms-auto">
    <a class="btn btn-outline-success me-2" href="/create_article"> + დაამატე შენი სტატია </a>
</form>

<br>
{% for article in articles %}
<div class="card">
   <div class="card-header d-flex justify-content-between align-items-center">
        <div>
            <small class="text-muted">
                ავტორი: <strong>{{ article["user_name"] }}</strong>
            </small>
            <small class="text-muted">
                {% if article.created_at %}
                    {{ article.created_at }}
                {% else %}
                    თარიღი არ არის მითითებული
                {% endif %}
            </small>
        </div>
        {% if current_user.is_authenticated and current_user.is_admin() %}
        <div>
            <a href="/update_article/{{ article['id'] }}" class="btn btn-warning btn-sm">რედაქტირება</a>
            <a href="/delete_article/{{ article['id'] }}"
               class="btn btn-danger btn-sm"
               onclick="return confirm('დარწმუნებული ხართ, რომ გსურთ სტატიის წაშლა?')">წაშლა</a>
        </div>
        {% endif %}
    </div>
  <div class="card-body">
    <div class="card text-center">
      <h5 class="card-title">{{ article["title"]}}</h5></div>
        {% if article.text|length > 200 %}
            <p class="card-text">{{ article.text[:30000] }}...</p>

                <a href="/article_info/{{ article.id }}" class="btn btn-sm btn-outline-primary">
                    მეტი
                </a>

        {% else %}
            <p class="card-text">{{ article.text }}</p>
        {% endif %}

        {% if article.img and article.img not in ['no photo', 'null', '', None] %}

            <img src="/static/image/{{ article['img'] }}" class="card-img-top" alt="..." width = "150px" height="70px">

        {% endif %}

  </div>
</div>
{%endfor%}
{% endblock %}
